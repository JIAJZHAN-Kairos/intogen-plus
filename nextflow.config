
// defaults
containersDir = "$PWD/containers"
datasetsDir = "$PWD/datasets"
annotationsFile = "$PWD/config/annotations.txt"
outputFolder = "$PWD/intogen_analysis"


manifest {
  homePage = 'http://www.intogen.org'
  description = 'IntOGen analysis pipeline'
}

params {
   output = outputFolder
   annotations = annotationsFile
   containers = containersDir
   datasets = datasetsDir
   debug = false
   debugFolder = "${params.output}/debug"
   seed = null
}


env {
    // set default values for datasets
    INTOGEN_DATASETS = params.datasets
    // FIXME only if user is interested in offline mode
    BGDATA_LOCAL = env.INTOGEN_DATASETS + '/bgdata'
    // TODO bind BGDATA_LOCAL in /bgdata in the containers that use it
    BGDATA_OFFLINE = "TRUE"
}


singularity {
	enabled = true
	cacheDir = params.containers
}

process {
    cpus = 1
    errorStrategy = (params.debug)? 'ignore' : 'terminate'

	withLabel: core {
		container = "file:///${singularity.cacheDir}/intogen-core.simg"
	}
	withLabel: bgsignature {
		container = "file:///${singularity.cacheDir}/signature.simg"
	}
    withName: OncodriveFML {
    	container = "file:///${singularity.cacheDir}/oncodrivefml.simg"
    }
    withName: OncodriveCLUSTL {
    	container = "file:///${singularity.cacheDir}/oncodriveclustl.simg"
    }
    withName: VEP {
    	container = "file:///${singularity.cacheDir}/vep.simg"
    }
    withName: dNdScv {
    	container = "file:///${singularity.cacheDir}/dndscv.simg"
    }
    withName: SMRegions {
    	container = "file:///${singularity.cacheDir}/smregions.simg"
    }
    withName: CBaSE {
    	container = "file:///${singularity.cacheDir}/cbase.simg"
    }
    withName: MutPanning {
    	container = "file:///${singularity.cacheDir}/mutpanning.simg"
    }
    withName: HotMAPS {
    	container = "file:///${singularity.cacheDir}/hotmaps.simg"
    }
    withName: deconstructSigs {
    	container = "file:///${singularity.cacheDir}/deconstructsigs.simg"
    }
    withName: Combination {
    	container = "file:///${singularity.cacheDir}/intogen-combination.simg"
    }

}

profiles {
    slurm {
        includeConfig 'config/slurm.conf'
    }
    local {
        includeConfig 'config/local.conf'
    }
}

timeline {
  enabled = true
}

trace {
  enabled = true
  fields = 'process,task_id,hash,name,attempt,status,exit,realtime,%cpu,vmem,rss,submit,start,complete,duration,realtime,rchar,wchar'
}
